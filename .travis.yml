language: python
python:
  - "2.7"
  - "3.6"
  - "3.7-dev"
services:
  - docker
# command to install dependencies
addons:
  apt:
    packages:
        - libblas-dev
        - liblapack-dev
        - libatlas-base-dev
        - libopenblas-base
        - libopenblas-dev
        - gfortran
        - openjdk-8-jdk
        - maven
install:
  - pip install codecov
  - pip install -r requirements.txt
  - pip install -r test_requirements.txt
before_install:
  - git clone --depth 1 https://github.com/saalfeldlab/render.git render -b master
  - export JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64/jre"
  - mvn -version
  - mvn package -pl render-ws-java-client -am -DskipTests -f render/pom.xml
  - export RENDER_CLIENT_JAR=`readlink -m $TRAVIS_BUILD_DIR/render/render-ws-java-client/target/render-ws-java-client-*-standalone.jar`
  - export RENDER_WS_JAVA_CLIENT_EXAMPLE_DATA=`readlink -m $TRAVIS_BUILD_DIR/render/render-ws-java-client/src/main/resources`
  - export RENDER_APP_EXAMPLE_DATA=`readlink -m $TRAVIS_BUILD_DIR/render/render-app/src/test/resources`
  - export RENDER_JAVA_HOME=$JAVA_HOME
  - mkdir -p /tmp/example_1 && cp -R $RENDER_WS_JAVA_CLIENT_EXAMPLE_DATA/example_1 /tmp/.
  - cp -R $RENDER_APP_EXAMPLE_DATA/* /tmp/.
  - export RENDER_EXAMPLE_DATA=/tmp
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker-compose up -d
env:
  global:
     - RENDER_HOST=localhost RENDER_PORT=8080 RENDER_CLIENT_SCRIPTS=$TRAVIS_BUILD_DIR/render/render-ws-java-client/src/main/scripts
     - secure: "gIvBfWzWZizVxIW3eJfMX4V4/wrtn6zVoI9lkDbnXgn42+jIUdZYLEnHdZDtgOYtwUHUiY0UuXX/D9pl5XK+5IrZ+ocRKv8vIL1APJNxJGWJThkk8ifQFn+fuG2MvlA1b3z3903FNMSw3AcG0479YucZkPx7TmexU5DHM/zf/+/KvCV5qDPKjZu4hL3o/njuwNZGpYmT0+pUvugiAhF1c5YBmPBMhaplUYKdjuGMeLOlB/QxmBdkTPWCeVda8ohB3ngGc2yjhtDPAaOo9LKNrdLje6DCr2Zv6e4qo27YNFpXoICN0qUPOaoGOoVJ/HOq8HUZgJMi9KiYH2oqP27RqPOHaGABK7PF5aMg6vvUBcCYP4n93rnbm7g4k/+A/mUeew9lXyrh8+O9d8ul5eNfLdaQ1HGnR093Vx53Sr7Q9lyNU/PUteMGzRYQw2EQGuryGiAKJ5tWD9HIHtqQ7iNZup8ijHCKVdmtLHROTHMvpcagQ33Sl/+U05E50YoDZRzvTNSaWUoNhl01xRIyp35KYy55Ei2X8eMTJlirdzKj1hAeOED98SmKx8ROypxJDzcO/N8AGlPRc9/l+OplKTvpnlD3Nsd/bxErWEmrBDtAkY05rfR48e9xtDyqV4KuAXy0wBJn5eqFEFpNNxzMi78CHsF023UodVsWAzn4HvAojrQ="
     - secure: "Pswk0hT1H9HxbDQVFa9jH9jyc8A/MvGyStl/NCDXTKzT9dN8Q5XNJ4LLzq+1w4FpZNao6OQTAahd0ZYK8/A3VQTywXrm6b8cKz2qhEvfOQZcP4BQbTzmqhpuVvM0pWZnORam+9jwHbiLhvOJuZFAg/NFPqlT5JJ6FamjrMTFfMez7Irr/0xXG+U0T0AnUBbwsDek1ed8AEO+NZDoOP4DnmbpfaZbVeti1bMjnlSbzP861wIxakIBMXO9SHP5jHDgSSs0Oj8anQktscmCyn/LpQETbRbEYqyqh9FXFt2NFU1KG+hLG7VGdtdzoJmKVIFmn3GQDugKWrAQFYLImCgtZzjQEgAFMCD67hO0R8VfiVz07ZXcySpw1OmLfJJoMMdDecd53QfzMqhYhod9e7eVcwRxnZ2milkcVpQMlCx8yfA1SZ6EZmRp/4U6hv0o8NZGTW8KGw/d3GXLFEEyUysNTNKZvALM/12pEYfABGefXoUXk8fFcg92gv1eUqmHLR8BMjMPIgD+93XwGeGiIGkEDABkuBLi4s9+tSN90te+yFhGaROH2nwQnabzOcTMQBMeU8/+55UJQ51PgekgYWs0xbZHc6nr4bwtyqKBlsk+Tm9+J2aVgVHX2sdoI05viVsZ8d5pY1/PjlfHZdeP2slJvk/dgKyNXRn9+PttHerUSF4="
     - secure: "bn7R7uFFv3opOFztEcFBx49QTLrY+HT5XlWyXU5l5opj+o40y1TixczXSzK5YkCWI2s1el1SqNIpmmCaiZ17NpjASyH4sHmrje/TWIOK8TpI2ON9KwZiszMEKQ3Y7Nz+KDQmXizNtSS+JWlo7Y/4LwpGGec3eNV0pYX3opMKf1xBSntX7KllQj2b2V74KI2bxGuJ/PP3qmU6zGFNv2/AcTr2RjGPmCrSM7SVexcK3SE1xzCdA9sxdT06pFNEjAAhJczdUHaheclrmFDw18+q0L/3biAlP5P7vp1K+SjA7XXqwkTpSFx4z0A1Cx1tQid6K5iU7dB135BU/NBC02xhkgU+FfMet2n56s8NFvu0Gdcn9uod6xPjHrXVTI8yb2J35zp1mgjg2M31yBEbH8uE77S5rnLN6LBKG03xvbLOJDDLL09ID17AE5l41kmL7jIrXenyRTFCZYH8dN7bs18F1+jRTkgIm5UC/fwSXk7/e1L18gK6rQFp/oPuykf/k7TEE/tBM8oCL9Yi2Du6g29HAF0s6H9FsPypM0cJHSwTccpt4d3qgwJ/1lhRVo9SkXa60tVqFaBqpKX09VYbstes9aGFqHn4XaajNxDuPLKALxptYMaP11QO1N7fVrDirtj8TJLNB2wvTs2HbFz+HPzNvpDen3WwG9JFIqfMU7wFMc4="
# command to run tests
script:
  - python setup.py test # or py.test for Python versions 3.5 and below
cache:   
  pip: true                                                                    
  directories:                                                                  
    - $HOME/.m2
after_success:
  - codecov -t 3f12d985-af62-455d-a11d-9669c039640d
  - "BRANCHES_TO_MERGE_REGEX='develop' BRANCH_TO_MERGE_INTO=master GITHUB_REPO=AllenInstitute/render-python .travis/merge_script.sh"
