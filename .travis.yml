language: python
python:
  - "2.7"
  - "3.6"
  - "3.7-dev"
services:
  - docker
# command to install dependencies
addons:
  apt:
    packages:
        - libblas-dev
        - liblapack-dev
        - libatlas-base-dev
        - libopenblas-base
        - libopenblas-dev
        - gfortran
        - openjdk-8-jdk
        - maven
install:
  - pip install codecov
  - pip install -r requirements.txt
  - pip install -r test_requirements.txt
before_install:
  - git clone --depth 1 https://github.com/saalfeldlab/render.git render -b master
  - export JAVA_HOME="/usr/lib/jvm/java-8-openjdk-amd64/jre"
  - mvn -version
  - mvn package -pl render-ws-java-client -am -DskipTests -f render/pom.xml
  - export RENDER_CLIENT_JAR=`readlink -m $TRAVIS_BUILD_DIR/render/render-ws-java-client/target/render-ws-java-client-*-standalone.jar`
  - export RENDER_WS_JAVA_CLIENT_EXAMPLE_DATA=`readlink -m $TRAVIS_BUILD_DIR/render/render-ws-java-client/src/main/resources`
  - export RENDER_APP_EXAMPLE_DATA=`readlink -m $TRAVIS_BUILD_DIR/render/render-app/src/test/resources`
  - export RENDER_JAVA_HOME=$JAVA_HOME
  - mkdir -p /tmp/example_1 && cp -R $RENDER_WS_JAVA_CLIENT_EXAMPLE_DATA/example_1 /tmp/.
  - cp -R $RENDER_APP_EXAMPLE_DATA/* /tmp/.
  - export RENDER_EXAMPLE_DATA=/tmp
  - echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
  - docker-compose up -d
env:
  global:
     - RENDER_HOST=localhost RENDER_PORT=8080 RENDER_CLIENT_SCRIPTS=$TRAVIS_BUILD_DIR/render/render-ws-java-client/src/main/scripts
     - secure: "gIvBfWzWZizVxIW3eJfMX4V4/wrtn6zVoI9lkDbnXgn42+jIUdZYLEnHdZDtgOYtwUHUiY0UuXX/D9pl5XK+5IrZ+ocRKv8vIL1APJNxJGWJThkk8ifQFn+fuG2MvlA1b3z3903FNMSw3AcG0479YucZkPx7TmexU5DHM/zf/+/KvCV5qDPKjZu4hL3o/njuwNZGpYmT0+pUvugiAhF1c5YBmPBMhaplUYKdjuGMeLOlB/QxmBdkTPWCeVda8ohB3ngGc2yjhtDPAaOo9LKNrdLje6DCr2Zv6e4qo27YNFpXoICN0qUPOaoGOoVJ/HOq8HUZgJMi9KiYH2oqP27RqPOHaGABK7PF5aMg6vvUBcCYP4n93rnbm7g4k/+A/mUeew9lXyrh8+O9d8ul5eNfLdaQ1HGnR093Vx53Sr7Q9lyNU/PUteMGzRYQw2EQGuryGiAKJ5tWD9HIHtqQ7iNZup8ijHCKVdmtLHROTHMvpcagQ33Sl/+U05E50YoDZRzvTNSaWUoNhl01xRIyp35KYy55Ei2X8eMTJlirdzKj1hAeOED98SmKx8ROypxJDzcO/N8AGlPRc9/l+OplKTvpnlD3Nsd/bxErWEmrBDtAkY05rfR48e9xtDyqV4KuAXy0wBJn5eqFEFpNNxzMi78CHsF023UodVsWAzn4HvAojrQ="
     - secure: "tnw8YYrVoasmJ+3I3VjENfx6BIBG2qaJ4m0+rUR9dal7cmrGTrcyJ1d41Nm+K1XKRvLvBkEHKBzdEVlg2XaAOVBTam6u+zW/Dc16ZXgz7yK1qXtytwiXBe2P7c9HePXIDA/SCapKXmjF5/Zt0BdpXv4fPyK8kbdIjels9Xt8teDTfSxJ6AfXlfXXPiF6A1Lzgf+z9GRL9GXZrgic6itFdNfgErGThgefQSJKr3wKR/wRyx87QD5juzrZtcwtFzcvvO8X8n6D+oOdc9XfRsE1EgFO8RHla32c0BbcKmRP8vwwtfVUt1tqU3SQZP6+n9EUBiSUR9/B50hCOiX5O2RdtHIMncJT0n4ZQe2PmTmwpcY1bU1NJpUszxPXNZrEHRdGqbXfiQq8+sONAWZcrzbqLsP2cXpt+4FrHk+iepu0RBLpLq/UdcVLozELgkNxM1C9k3OF6OlAC//5jWi4hjeoc2L8LpR09Cxm7PCtBvqbCNO2mPhv+h4dsFzmlyN2JL34lQyfzD1v1Jqz4ifJHYupKKtIdA7UiU+RU40ylDzTKfvlI63MkUwxS2u4BY0Gc5WWy/NoJuF6F39c+peoLgcoHiKnXoIvTyWCNSfieXCnuiHrU7nLnijM9qzSZxM6a43KiSGRZAQInQUXzKX5a7cGHaQIFskd3TK71emnhdewM40="
     - secure: "JPH39Et4o5pMJ46skTNv4Bytn88Rstf8rkylNaVqVIu4dYfPJeT3iPRBdzDthTU1ONiuK49nhOdd9/DOPJr5r7UyDvcQXugG0qFvG8JqjZIPMu69iEjZ8dJa2DJm2h8rfoo6KTgYgjbTZKPJtO4rdhygRuZn5HGuj9St0090RtKAPMxZSqBohC0iRJPA/0Jiov9OSYJ7LsWNHz9Y2Ji4FOed9BzyjJk0+Uip2dusOIT22ytqqVIpxqmMx0XVlWHNEYDNOjSV3yLoFhI4o4hxqxjZ+Z0V+ta1MwYRtPQ9oT0qAxLChFm79JhA5wGn2D3MJno8W3ByIYV0zIiHmrjGf11VDV0HvHcbuosDrY3SjuP2mnQ9fxPZxEpg8CzrEG2ObEOqaooX2QwqYiko6bCnmIpwNUZEd8gzeigvko7SsBJQ31Qqi1nDSNuEzklplepyeV4zGLgQSKZ9/+SH8/RkL6qqd3y0jzZBIXPhReHLTL2k92FhYyqJQMCG3mqTgCWnr7iOyFd96uIdHD/SglMBfQ+ZrFdm7Z4OQmhycLFTDOIAulRcl7rqmYIcXzVJRL9GGY+TVG0JCNZ1y+VfQhEf5pVXRayoCwI28fZIytvPgGnR1il+bfqresCxWZ2ujNJt+Vf+yY1pXhJAnwbGcog/2TAxqjvUQWv9zXwxo/6Q8yk="
# command to run tests
script:
  - python setup.py test # or py.test for Python versions 3.5 and below
cache:   
  pip: true                                                                    
  directories:                                                                  
    - $HOME/.m2
after_success:
  - codecov -t 3f12d985-af62-455d-a11d-9669c039640d
  - "BRANCHES_TO_MERGE_REGEX='develop' BRANCH_TO_MERGE_INTO=master GITHUB_REPO=AllenInstitute/render-python .travis/merge_script.sh"
